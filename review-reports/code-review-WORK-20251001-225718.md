# Code Review Report: WORK-20251001-225718-3465379
**Date**: 2025-10-01
**Reviewer**: Project Structure Engineer 2
**Scope**: Review uncommitted code changes in ffl-playoffs-api/src/

## Summary
Review of newly added domain models, use cases, DTOs, ports, and controllers. Found **9 compilation errors** and **architecture compliance issues** that must be fixed before deployment.

## Architecture Compliance ✅

### What's Correct
✅ **League.java** - Pure domain model, NO framework dependencies, rich business logic
✅ **LeagueRepository.java** - Domain port interface (fixed missing methods)
✅ **CreateLeagueUseCase.java** - Proper application layer orchestration
✅ **LeagueController.java** - Infrastructure layer REST adapter
✅ **Hexagonal architecture** - Proper layer separation maintained

### Fixed Issues
✅ **LeagueRepository.java** - Added missing methods:
- `findByCode(String code)`
- `findAll()`
- `existsByCode(String code)`

## Compilation Errors ❌

### 1. ValidateGoogleJWTUseCase.java:33
**Error**: `cannot find symbol: method validate(String)`
**Location**: GoogleJwtValidator
**Fix**: Add `validate(String token)` method to GoogleJwtValidator class

### 2. ProcessGameResultsUseCase.java:53
**Error**: `incompatible types: List<TeamSelection> cannot be converted to List<TeamSelectionDTO>`
**Issue**: Domain repository returns domain entities, not DTOs
**Fix**: Change line 53 to:
```java
List<TeamSelection> selections = teamSelectionRepository.findByGameIdAndWeek(gameId, week);
```

### 3. ProcessGameResultsUseCase.java:79
**Error**: `incompatible types: TeamSelectionDTO cannot be converted to TeamSelection`
**Issue**: Trying to save DTO instead of domain entity
**Fix**: Convert DTO to domain entity before saving or work with domain entities throughout

### 4. BuildRosterUseCase.java:48
**Error**: `cannot find symbol: method existsByLeaguePlayerId(UUID)`
**Location**: RosterRepository
**Fix**: Add to RosterRepository.java:
```java
boolean existsByLeaguePlayerId(UUID leaguePlayerId);
```

### 5-8. GameRepositoryImpl.java
**Error**: Missing implementation of GameRepository methods
**Issues**:
- `existsByCode(String)` not implemented
- Method signatures don't match GameRepository interface
**Fix**: Implement all GameRepository interface methods correctly

### 9. GameMapper.java:50
**Error**: `method setName in class Game cannot be applied to given types`
**Issue**: setName() requires LocalDateTime parameter for lock validation
**Fix**: Use `game.setName(document.getName())` without time parameter (initial creation)

## Repository Interface Issues

### RosterRepository.java - Missing Methods
```java
// Need to add:
boolean existsByLeaguePlayerId(UUID leaguePlayerId);
```

### GameRepository.java - Check Interface
- Verify all methods referenced in GameController exist in interface
- Ensure existsByCode(String) is defined

## Type Consistency Issues

### ProcessGameResultsUseCase.java
**Problem**: Mixing domain entities with DTOs
**Violation**: Application layer should work with domain entities, not DTOs
**Solution**:
1. Retrieve TeamSelection entities from repository
2. Perform domain operations on entities
3. Save entities back to repository
4. Convert to DTOs only when returning to controller

## Recommendations

### Immediate Actions (CRITICAL)
1. ✅ Fixed: Add missing methods to LeagueRepository
2. ❌ Add `validate(String)` to GoogleJwtValidator
3. ❌ Fix ProcessGameResultsUseCase type mismatches
4. ❌ Add `existsByLeaguePlayerId()` to RosterRepository
5. ❌ Implement all GameRepository methods in GameRepositoryImpl
6. ❌ Fix GameMapper.setName() call

### Architecture Improvements
- **Use Case Layer**: Should work with domain entities, not DTOs
- **Domain Ports**: Must return domain entities only
- **DTO Mapping**: Should happen in controllers/adapters, not use cases

## Next Steps
1. Fix all 9 compilation errors
2. Run `./gradlew compileJava` to verify
3. Run `./gradlew test` to ensure tests pass
4. Commit changes with proper message

## Status
**CHANGES REQUIRED** - Code cannot compile, must fix before deployment

## Files Reviewed
- ✅ League.java
- ✅ LeagueRepository.java (fixed)
- ✅ CreateLeagueUseCase.java
- ✅ LeagueController.java
- ❌ ValidateGoogleJWTUseCase.java (errors)
- ❌ ProcessGameResultsUseCase.java (errors)
- ❌ BuildRosterUseCase.java (errors)
- ❌ GameRepositoryImpl.java (errors)
- ❌ GameMapper.java (errors)
